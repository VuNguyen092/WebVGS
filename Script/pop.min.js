var Pop = function (a) {
    this.o = $.extend(
        {},
        {
            stay: "fixed",
            stayPosition: "center",
            blurElement: null,
            maskColor: "#000",
            maskOpacity: "0.75",
            showSpeed: 0,
            popZindex: 999,
            maskCanHide: false,
            beforeHandler: function () { },
            afterHandler: function () { },
        },
        a
    );
    this.mask = [];
    this.eles = [];
};
Pop.prototype.setPositionHd = function (d) {
    var f = this;
    var b = $(d);
    var a = b.width();
    var e = b.height();
    var c = $(document).scrollTop() + $(window).height() / 2;
    switch (f.o.stayPosition) {
        case "center":
            $(d).css({
                position: f.o.stay,
                left: "50%",
                top: f.o.stay == "fixed" ? "50%" : c + "px",
                //marginLeft: -1 * Math.floor(a / 2) + "px",
                transform: "translate(-50%)",
                marginTop: -1 * Math.floor(e / 2) + "px",
                zIndex: f.o.popZindex + f.eles.length + 1,
            });
            break;
        case "top":
            $(d).css({
                position: f.o.stay,
                left: "50%",
                top: f.o.stay == "fixed" ? 0 : $(document).scrollTop() + "px",
                transform: "translate(-50%)",
                zIndex: f.o.popZindex + f.eles.length + 1,
            });
            break;
        default:
            break;
    }
};
Pop.prototype.setMaskHd = function () {
    var b = this;
    var a = $(document).height();
    b.mask.unshift($("<div>"));
    b.mask[0].css({
        display: "block",
        height: a + "px",
        position: "fixed",
        left: "0",
        top: "0",
        right: "0",
        bottom:"0",
        backgroundColor: b.o.maskColor,
        opacity: b.o.maskOpacity,
        zIndex: b.o.popZindex + b.mask.length,
    });

    $("body").append(b.mask[0]);
    if (b.o.blurElement) {
        $(b.o.blurElement).css({
            filter: "blur(5px)",
            webkitFilter: "blur(5px)",
            MozFilter: "blur(5px)",
            msFilter: "blur(5px)",
            OFilter: "blur(5px)",
        });
    }
};

Pop.prototype.show = function (a, callback) {
    var b = this;
    b.eles.unshift($(a));
    b.o.beforeHandler(b.eles[0]);
    b.eles[0].show();
    b.setPositionHd(a);
    b.setMaskHd();
    if (b.o.maskCanHide) {
        b.mask[0].on("click", function () {
            b.hide(callback);
        });
    }
};

Pop.prototype.hide = function (callback) {
    var a = this;
    if (a.eles.length <= 0) {
        return false;
    }

    if (a.o.blurElement && a.eles.length == 1) {
        $(a.o.blurElement).css({
            filter: "none",
            webkitFilter: "none",
            MozFilter: "none",
            msFilter: "none",
            OFilter: "none",
        });
    }
    a.o.afterHandler(a.eles[0]);
    a.eles[0].hide();

    if (a.o.maskCanHide) {
        a.mask[0].off("click");
    }
    a.mask[0].remove();
    a.eles.shift();
    a.mask.shift();

    if (callback) {
        callback();
    }
};

var pop = new Pop({
    maskCanHide: true
});

$(".close-pop").click(function () {
    pop.hide()
});

$(".close-msg").click(function () {
    pop.mask[0].click();
});

$(".close-video").click(function () {
    $('#video-iframe').attr("src", "");
    pop.hide();
});

